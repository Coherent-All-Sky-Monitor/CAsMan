# CAsMan Configuration File
# Part type definitions (required)
PART_TYPES:
  1: [ANTENNA, ANT]
  2: [LNA, LNA]
  3: [COAXSHORT, CXS]
  4: [COAXLONG, CXL]
  5: [BACBOARD, BAC]
  6: [SNAP, SNP]

# Database configuration
CASMAN_ASSEMBLED_DB: database/assembled_casm.db
CASMAN_PARTS_DB: database/parts.db

# Database backup and synchronization
database:
  sync:
    # Enable/disable cloud backup and sync
    enabled: true
    
    # Backend: 'r2' (Cloudflare R2), 's3' (AWS S3), or 'disabled'
    backend: r2
    
    # Auto-sync on package install (not on every import)
    auto_sync_on_import: false
    
    # Cache TTL in seconds (1 hour = 3600)
    cache_ttl_seconds: 3600
    
    # Number of backup versions to keep
    keep_versions: 10
    
    # Backup triggers
    backup_on_scan_count: 10      # Backup every N scans
    backup_on_hours: 24.0          # Backup every N hours (if scans occurred)
    
    # R2 Free Tier Safety Limits (enforced to prevent exceeding quotas)
    # Cloudflare R2 Free Tier: 10 GB storage, 1M Class A ops/month, 10M Class B ops/month
    quota_limits:
      storage_gb: 10.0              # Max storage (GB) - 10 GB free tier
      class_a_operations: 1000000   # Max Class A ops/month (writes) - 1M free tier
      class_b_operations: 10000000  # Max Class B ops/month (reads) - 10M free tier
      warn_threshold: 0.8           # Warn at 80% usage
      block_threshold: 0.95         # Block operations at 95% usage

# Cloudflare R2 configuration
# Set via environment variables or uncomment and set here:
r2:
  # account_id: your-account-id
  # access_key_id: your-access-key-id
  # secret_access_key: your-secret-access-key
  bucket_name: casman-databases
  # endpoint: https://your-account-id.r2.cloudflarestorage.com
  region: auto
  
  # Public URLs for credential-free database downloads
  # Users can download latest databases without R2 credentials
  # Set these to your R2 public bucket URLs (after enabling public access)
  public_urls:
    parts_db: "https://pub-xxxxx.r2.dev/backups/parts.db/latest_parts.db"
    assembled_db: "https://pub-xxxxx.r2.dev/backups/assembled_casm.db/latest_assembled_casm.db"

# Barcode generation settings
barcode:
  default_format: code128
  output_directory: barcodes
  
  # Barcode image dimensions (in inches)
  width_inches: 1.2
  height_inches: 0.75
  
  # Coax cable label settings (text-only labels for thin cables)
  coax:
    # Use classic barcode (true) or text-only label (false)
    use_barcode: True
    
    # Coax label dimensions (in inches)
    width_inches: 1.0
    height_inches: 0.34
    
    # Cable diameters in inches (for label sizing)
    lmr95_diameter: 0.141    # LMR95 cable diameter (COAXSHORT)
    lmr195_diameter: 0.233   # LMR195 cable diameter (COAXLONG)
    font_name: "Arial"       # Font to use for text labels
    background_color: "white"  # Label background color
    text_color: "black"      # Text color
    
    # Print page layout settings for coax labels (all dimensions in inches)
    page_layout:
      page_width: 8.5               # Page width (US Letter)
      page_height: 11.0             # Page height (US Letter)
      columns: 7                    # Number of label columns per page
      rows: 13                      # Number of label rows per page
      horizontal_spacing: 0.108268  # Horizontal distance between labels (2.75mm)
      vertical_spacing: 0.40625    # Vertical distance between labels (10mm)
      margin_top: 0.984252          # Top margin (25mm)
      margin_bottom: 0.669291       # Bottom margin (17mm)
      margin_left: 0.433071         # Left margin (11mm)
      margin_right: 0.433071        # Right margin (11mm)
  
  # Print page layout settings (all dimensions in inches)
  page:
    margin_inches: 0.5          # Margin around the page edges
    horizontal_spacing_inches: 0.25  # Space between barcodes horizontally
    vertical_spacing_inches: 0.25    # Space between barcodes vertically
    images_per_row: 3            # Number of barcodes per row
    dpi: 300                     # Dots per inch for rendering

# Unified web application settings
web_app:
  # Development server settings
  dev:
    port: 5555
    host: "0.0.0.0"
  
  # Production server settings
  production:
    port: 8998
    host: "0.0.0.0"
    workers: 4
    worker_class: "sync"
  
  # Interface configuration
  enable_scanner: true         # Enable scanner interface (for commissioning/repairs)
  enable_visualization: true   # Enable visualization interface (for viewing chains)
  # Set enable_scanner=false if you only want the visualization interface
  # Set enable_visualization=false if you only want the scanner interface

# Antenna grid / array layout configuration
grid:
  core:
    array_id: "C"          # Leading letter for core array positions
    north_rows: 21          # Number of rows north of center (N001..N021)
    south_rows: 21          # Number of rows south of center (S001..S021)
    east_columns: 6         # Number of east columns (E01..E06)
    allow_expansion: true   # Future expansion: larger offsets (N/C/S000-999) and east columns (E01-99)
    
    # Kernel index mapping for correlator processing
    # Maps grid positions to kernel indices (0-255) for 256-antenna correlator
    # Only east columns E01-E06 from rows CN021 through CS021 are mapped
    kernel_index:
      enabled: true         # Enable kernel index mapping for this array
      max_index: 255        # Maximum kernel index (0-255 = 256 antennas)
      # Grid position for kernel index 0
      start_row: 21         # North row 21 (CN021)
      start_column: 1       # East column 1 (E01)
      # Mapping follows row-major order: (row, col) -> kernel_idx
      # CN021E01 -> 0, CN021E02 -> 1, ..., CN021E06 -> 5
      # CN020E01 -> 6, CN020E02 -> 7, ..., CN020E06 -> 11
      # ... continuing through center row and south rows ...
      # CS021E01 -> 252, CS021E02 -> 253, ..., CS021E06 -> 257 (but max is 255)
      # So CS021E05 and CS021E06 are NOT mapped (exceed max_index)
  
  # Example: Outrigger array configuration (uncomment to enable)
  # outriggers:
  #   array_id: "O"        # Leading letter for outrigger positions
  #   north_rows: 10       # Number of rows north of center (N001..N010)
  #   south_rows: 10       # Number of rows south of center (S001..S010)
  #   east_columns: 4      # Number of east columns (E01..E04)
  #   allow_expansion: false


# Logging configuration
logging:
  level: INFO
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file_path: logs/casman.log
  max_file_size_mb: 10
  backup_count: 5
