#!/bin/bash
# Pre-commit hook to update documentation
# Install: cp .github/hooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

echo "üîç Checking for changes requiring documentation updates..."

# Always sync root README into docs before any generation
echo "üìÑ Syncing docs/main.md from root README.md..."
mkdir -p docs
cp README.md docs/main.md
git add docs/main.md

# Check if any Python files in casman/ have changed
if git diff --cached --name-only | grep -E "(casman/.*\.py|docs/generate_docs\.py)" > /dev/null; then
    echo "üìö Python source files changed, updating documentation..."
    
    # Generate new documentation
    cd docs && python generate_docs.py && cd ..
    
    # Update coverage info
    echo "üìä Updating coverage statistics..."
    python .github/scripts/update_coverage.py
    
    # Stage any updated documentation files
    git add docs/
    git add README.md
    
    # Check if documentation was actually updated
    if git diff --cached --name-only | grep -E "(docs/.*\.md|README\.md)" > /dev/null; then
        echo "‚úÖ Documentation updated and staged for commit"
    else
        echo "‚ÑπÔ∏è  No documentation changes needed"
    fi
else
    echo "‚ÑπÔ∏è  No Python source changes detected, skipping documentation update"
fi

# Continue with the commit
exit 0
